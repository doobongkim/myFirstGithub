{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Microsoft Sentinel 통합 문서",
      "metadata": {
        "description": "갤러리 또는 저장된 목록에서 사용되는 통합 문서의 이름입니다. 이 이름은 리소스 그룹 내에서 고유해야 합니다."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "아래에 통합 문서가 표시되는 갤러리입니다. 지원되는 값으로는 통합 문서, tsg 등이 있습니다. 일반적으로 '통합 문서'입니다."
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourcegroups/eland_sentinal/providers/microsoft.operationalinsights/workspaces/elandsentinal",
      "metadata": {
        "description": "통합 문서가 연결될 리소스 인스턴스의 ID"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "이 통합 문서 인스턴스의 고유한 GUID"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"1b80579f-65e9-422a-b588-7dcc0b09c4b8\",\"cellValue\":\"SELECT_TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"개요\",\"subTarget\":\"SEC_OVERVIEW\",\"preText\":\"OverView\",\"style\":\"link\"},{\"id\":\"d4237d50-f1b6-4ce5-89b8-b4e4e973ccf0\",\"cellValue\":\"SELECT_TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"인시던트 상세 \",\"subTarget\":\"SEC_MON\",\"style\":\"link\"},{\"id\":\"5392aef4-1487-4eaa-9871-7007e0adc27c\",\"cellValue\":\"SELECT_TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"계정 위협 및 활동\",\"subTarget\":\"ID_MON\",\"style\":\"link\"},{\"id\":\"3bacdf79-fda8-4e90-9f08-d6ff6183c622\",\"cellValue\":\"SELECT_TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"서버 모니터링\",\"subTarget\":\"SVR_MON\",\"style\":\"link\"}]},\"name\":\"링크 - 4\"},{\"type\":1,\"content\":{\"json\":\"## Log Analytics 작업영역 선택\"},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SEC_OVERVIEW\"},\"name\":\"텍스트 - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::tenant\"],\"parameters\":[{\"id\":\"ae860f61-487f-46b9-82ed-8f3d2e1bbea2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_SUB\",\"label\":\"구독\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type == \\\"microsoft.resources/subscriptions\\\"\\r\\n| project id, name\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607\"},{\"id\":\"5fffca93-af49-4b8c-9ea8-cae9409e2fdd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_RG\",\"label\":\"리소스그룹\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type =~ \\\"microsoft.resources/subscriptions/resourcegroups\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\"\\r\\n| project id, name\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourceGroups/Eland_Sentinal\"},{\"id\":\"81efd9b7-7e94-4a5e-8d51-6c5e2b9d415f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_LA\",\"label\":\"LogAnalytics 작업영역\",\"type\":2,\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\" and (resourceGroup =~ \\\"{SEC_MON_RG:label}\\\")\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\"},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SEC_OVERVIEW\"},\"name\":\"매개 변수 - 1 - 복사\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## 인시던트 발생 현황\\r\\n---\"},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"Overview_GRP\"},{\"type\":1,\"content\":{\"json\":\"## 인시던트 대응현황\\r\\n---\"},\"customWidth\":\"50\",\"name\":\"텍스트 - 4\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f6b11cf0-ce6b-40fc-b874-afdc02bcb0a1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange_G\",\"label\":\"시간 범위\",\"type\":4,\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":172800000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = workspace('{SEC_MON_LA}').SecurityIncident | where CreatedTime {TimeRange_G:value};\\r\\ndata\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize Count = count() by Severity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on CreatedTime from {TimeRange_G:start} to {TimeRange_G:end} step {TimeRange_G:grain} by Severity)\\r\\n on Severity\\r\\n | project-away CreatedTime\\r\\n| extend Severitys = Severity\\r\\n| union (\\r\\n data \\r\\n | summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on CreatedTime from {TimeRange_G:start} to {TimeRange_G:end} step {TimeRange_G:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Severity = 'All', Severitys = '*' \\r\\n)\\r\\n| extend Severity_ = iif(Severity == \\\"All\\\", 0,iif(Severity == \\\"High\\\", 1, iif(Severity == \\\"Medium\\\", 2, iif(Severity == \\\"Low\\\", 3, 4))))\\r\\n| order by Severity_ asc\\r\\n\",\"size\":4,\"title\":\"심각도별 인시던트 발생 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"exportedParameters\":[{\"fieldName\":\"Severity\",\"parameterName\":\"SELECT_SEV\",\"defaultValue\":\"All\"},{\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Severity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false,\"size\":\"auto\"}},\"customWidth\":\"50\",\"name\":\"쿼리 - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = workspace('{SEC_MON_LA}').SecurityIncident;\\r\\ndata\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize Count = count() by Status\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on CreatedTime from {TimeRange_G:start} to {TimeRange_G:end} step {TimeRange_G:grain} by Status)\\r\\n on Status\\r\\n | project-away CreatedTime\\r\\n| extend _Status = Status\\r\\n| union (\\r\\n data \\r\\n | summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on CreatedTime from {TimeRange_G:start} to {TimeRange_G:end} step {TimeRange_G:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Status = 'All', _Status = '*' \\r\\n)\\r\\n| extend _Status = iif(Status == \\\"All\\\", 0,iif(Status == \\\"New\\\", 1, iif(Status == \\\"Active\\\", 2, iif(Status == \\\"Closed\\\", 3, 4))))\\r\\n| order by _Status asc\\r\\n\",\"size\":4,\"title\":\"인시던트 처리 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"exportFieldName\":\"Status\",\"exportParameterName\":\"SELECT_STATUS\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":21,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"쿼리 - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {TimeRange_G:value}\\r\\n| where \\\"{SELECT_SEV}\\\" == \\\"All\\\" or \\\"{SELECT_SEV}\\\" == Severity\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by Severity, bin(CreatedTime, {TimeRange_G:grain})\",\"size\":1,\"title\":\"심각도({SELECT_SEV}) 인시던트 발생 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"timeBrushParameterName\":\"TimeRange_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"tileSettings\":{\"showBorder\":false},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"cntHigh\",\"label\":\"높음\",\"color\":\"red\"},{\"seriesName\":\"cntMed\",\"label\":\"중간\",\"color\":\"orange\"},{\"seriesName\":\"cntLow\",\"label\":\"낮음\",\"color\":\"lightBlue\"}]}},\"customWidth\":\"50\",\"name\":\"쿼리 - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {TimeRange_G:value}\\r\\n| where \\\"{SELECT_STATUS}\\\" == \\\"All\\\" or \\\"{SELECT_STATUS}\\\" == Status\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by Status, bin(CreatedTime, {TimeRange_G:grain})\",\"size\":1,\"title\":\"시간별 상태({SELECT_STATUS}) 인시던트 처리 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"timeBrushParameterName\":\"TimeRange_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"name\":\"쿼리 - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {TimeRange_G:value}\\r\\n| where \\\"{SELECT_SEV}\\\" == \\\"All\\\" or \\\"{SELECT_SEV}\\\" == Severity\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\]\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by alertType\",\"size\":1,\"title\":\"인시던트 종류별 발생 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"sortBy\":[]},\"customWidth\":\"50\",\"name\":\"쿼리 - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {TimeRange_G:value}\\r\\n| where \\\"{SELECT_STATUS}\\\" == \\\"All\\\" or \\\"{SELECT_STATUS}\\\" == Status\\r\\n| extend flag = iff(isnull(Owner.assignedTo), \\\"미할당\\\", \\\"할당\\\")\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by flag\",\"size\":1,\"title\":\"상태({SELECT_STATUS})인시던트 담당자 할당 현황\",\"timeContextFromParameter\":\"TimeRange_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"쿼리 - 3\"}]},\"customWidth\":\"67\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SEC_OVERVIEW\"},\"name\":\"SEC_OVERVIEW_GROUP_01\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Security Manager\\r\\n---\"},\"name\":\"텍스트 - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"95da1a38-31c7-4bf5-9297-01f2951621f8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SELECT_SUB\",\"label\":\"구독\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type == \\\"microsoft.resources/subscriptions\\\"\\r\\n| project id, name\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607\"},{\"id\":\"175c583e-fadc-45bc-a2f5-f59a692b6b37\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SELECT_RG\",\"label\":\"리소스 그룹\",\"type\":2,\"description\":\"작업영역을 포함하는 리소스 그룹 리스트\",\"query\":\"resourcecontainers\\r\\n| where type =~ \\\"microsoft.resources/subscriptions/resourcegroups\\\" and\\r\\n        id hasprefix \\\"{SELECT_SUB}\\\"\\r\\n| project id, name\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourceGroups/Eland_Sentinal\"},{\"id\":\"754dbbe3-6e4d-4fc0-8b67-9673a68cb26a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"REQ_URI\",\"type\":1,\"isRequired\":true,\"query\":\"let REQ_URI = iff(isempty(\\\"{SELECT_RG}\\\"), \\\"{SELECT_SUB}\\\", \\\"{SELECT_RG}\\\");\\r\\nprint REQ_URI\",\"isHiddenWhenLocked\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"59ddf55c-c833-43e0-a4b2-b1e6c8a1c04d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"REQ_TIME\",\"label\":\"조회기간(최대1년)\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2592000000}},{\"id\":\"3f31e1c6-cbf9-49b0-8fa5-c5f8620b4b5f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"COMP_TIME\",\"label\":\"비교기간(최대1년)\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"value\":{\"durationMs\":2592000000}},{\"id\":\"c88079d1-7ae6-48e8-9dfb-2e6209a8fc48\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"REQ_TYPE\",\"label\":\"조회단위\",\"type\":2,\"isRequired\":true,\"isHiddenWhenLocked\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\r\\n        \\\"label\\\": \\\"기간합계\\\",\\r\\n        \\\"value\\\": \\\"none\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"일별\\\",\\r\\n        \\\"value\\\": \\\"none\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"월별\\\",\\r\\n        \\\"value\\\": \\\"none\\\"\\r\\n    }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"none\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":\\\"{\\\\r\\\\n\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Usage\\\\\\\",\\\\r\\\\n\\\\t\\\\\\\"timeframe\\\\\\\": \\\\\\\"Custom\\\\\\\", \\\\r\\\\n\\\\t\\\\\\\"timePeriod\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\\\\"from\\\\\\\": \\\\\\\"{REQ_TIME:startISO}\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\\\\"to\\\\\\\": \\\\\\\"{REQ_TIME:endISO}\\\\\\\"\\\\r\\\\n\\\\t},\\\\r\\\\n\\\\t\\\\\\\"dataset\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\\\\"granularity\\\\\\\": \\\\\\\"{REQ_TYPE}\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\\\\"aggregation\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\\\\"totalCost\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"PreTaxCost\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"function\\\\\\\": \\\\\\\"Sum\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t},\\\\r\\\\n\\\\t\\\\t\\\\\\\"grouping\\\\\\\": [\\\\r\\\\n\\\\t\\\\t\\\\t{\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Dimension\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"SubscriptionId\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t]\\\\r\\\\n\\\\t}\\\\r\\\\n}\\\",\\\"headers\\\":[],\\\"method\\\":\\\"POST\\\",\\\"path\\\":\\\"{REQ_URI}/providers/Microsoft.CostManagement/query?\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-11-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$..properties\\\",\\\"columns\\\":[]}}]}\",\"size\":4,\"showAnalytics\":true,\"title\":\"조회기간 비용합계\",\"queryType\":12,\"visualization\":\"tiles\",\"sortBy\":[],\"tileSettings\":{\"titleContent\":{},\"rightContent\":{\"columnMatch\":\"PreTaxCost\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"KRW\",\"style\":\"currency\",\"minimumFractionDigits\":0}}},\"showBorder\":false,\"size\":\"auto\"},\"graphSettings\":{\"type\":0,\"topContent\":{},\"nodeIdField\":\"PreTaxCost\",\"sourceIdField\":\"UsageDate\",\"targetIdField\":\"SubscriptionId\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"hivesMargin\":5},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"customWidth\":\"33\",\"showPin\":false,\"name\":\"쿼리 - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":\\\"{\\\\r\\\\n\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Usage\\\\\\\",\\\\r\\\\n\\\\t\\\\\\\"timeframe\\\\\\\": \\\\\\\"Custom\\\\\\\", \\\\r\\\\n\\\\t\\\\\\\"timePeriod\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\\\\"from\\\\\\\": \\\\\\\"{COMP_TIME:startISO}\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\\\\"to\\\\\\\": \\\\\\\"{COMP_TIME:endISO}\\\\\\\"\\\\r\\\\n\\\\t},\\\\r\\\\n\\\\t\\\\\\\"dataset\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\\\\"granularity\\\\\\\": \\\\\\\"{REQ_TYPE}\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\\\\"aggregation\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\\\\"totalCost\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"PreTaxCost\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"function\\\\\\\": \\\\\\\"Sum\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t},\\\\r\\\\n\\\\t\\\\t\\\\\\\"grouping\\\\\\\": [\\\\r\\\\n\\\\t\\\\t\\\\t{\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Dimension\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"SubscriptionId\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t]\\\\r\\\\n\\\\t}\\\\r\\\\n}\\\",\\\"headers\\\":[],\\\"method\\\":\\\"POST\\\",\\\"path\\\":\\\"{REQ_URI}/providers/Microsoft.CostManagement/query?\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-11-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$..properties\\\",\\\"columns\\\":[]}}]}\",\"size\":4,\"showAnalytics\":true,\"title\":\"비교기간 비용합계\",\"queryType\":12,\"visualization\":\"tiles\",\"sortBy\":[],\"tileSettings\":{\"titleContent\":{},\"rightContent\":{\"columnMatch\":\"PreTaxCost\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"KRW\",\"style\":\"currency\",\"minimumFractionDigits\":0}}},\"showBorder\":false,\"size\":\"auto\"},\"graphSettings\":{\"type\":0,\"topContent\":{},\"nodeIdField\":\"PreTaxCost\",\"sourceIdField\":\"UsageDate\",\"targetIdField\":\"SubscriptionId\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"hivesMargin\":5},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"customWidth\":\"33\",\"showPin\":false,\"name\":\"쿼리 - 1 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":\\\"{\\\\r\\\\n\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Usage\\\\\\\",\\\\r\\\\n\\\\t\\\\\\\"timeframe\\\\\\\": \\\\\\\"TheLastBillingMonth\\\\\\\", \\\\r\\\\n\\\\t\\\\\\\"dataset\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\\\\"granularity\\\\\\\": \\\\\\\"{REQ_TYPE}\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\\\\"aggregation\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\\\\"totalCost\\\\\\\": {\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"PreTaxCost\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"function\\\\\\\": \\\\\\\"Sum\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t},\\\\r\\\\n\\\\t\\\\t\\\\\\\"grouping\\\\\\\": [\\\\r\\\\n\\\\t\\\\t\\\\t{\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"type\\\\\\\": \\\\\\\"Dimension\\\\\\\",\\\\r\\\\n\\\\t\\\\t\\\\t\\\\t\\\\\\\"name\\\\\\\": \\\\\\\"SubscriptionId\\\\\\\"\\\\r\\\\n\\\\t\\\\t\\\\t}\\\\r\\\\n\\\\t\\\\t]\\\\r\\\\n\\\\t}\\\\r\\\\n}\\\",\\\"headers\\\":[],\\\"method\\\":\\\"POST\\\",\\\"path\\\":\\\"{REQ_URI}/providers/Microsoft.CostManagement/query?\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2019-11-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$..properties\\\",\\\"columns\\\":[]}}]}\",\"size\":4,\"showAnalytics\":true,\"title\":\"지난달 청구비용\",\"queryType\":12,\"visualization\":\"tiles\",\"sortBy\":[],\"tileSettings\":{\"titleContent\":{},\"rightContent\":{\"columnMatch\":\"PreTaxCost\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":0,\"options\":{\"currency\":\"KRW\",\"style\":\"currency\",\"minimumFractionDigits\":0}}},\"showBorder\":false,\"size\":\"auto\"},\"graphSettings\":{\"type\":0,\"topContent\":{},\"nodeIdField\":\"PreTaxCost\",\"sourceIdField\":\"UsageDate\",\"targetIdField\":\"SubscriptionId\",\"graphOrientation\":3,\"showOrientationToggles\":false,\"nodeSize\":null,\"staticNodeSize\":100,\"colorSettings\":null,\"hivesMargin\":5},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"customWidth\":\"33\",\"showPin\":false,\"name\":\"쿼리 - 1 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" and\\r\\n        id hasprefix \\\"{SELECT_SUB}\\\"\\r\\n| extend dailyquotaGB = iif(properties.workspaceCapping.dailyQuotaGb !=-1.0, strcat(properties.workspaceCapping.dailyQuotaGb,\\\"(GB/일)\\\"),\\\"미설정\\\")\\r\\n| project ['LogAnalytics']=id, resourceGroup, ['가격계층']=tostring(properties.sku.name), ['보존기간(일)']=tostring(properties.retentionInDays), ['일일 캡']=tostring(dailyquotaGB), ['nameLA']=name\",\"size\":1,\"title\":\"작업영역 정보\",\"exportedParameters\":[{\"fieldName\":\"LogAnalytics\",\"parameterName\":\"ARG_LA\",\"parameterType\":1},{\"fieldName\":\"resourceGroup\",\"parameterName\":\"ARG_RG\",\"parameterType\":1},{\"fieldName\":\"nameLA\",\"parameterName\":\"ARG_LANAME\",\"parameterType\":1}],\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\",\"crossComponentResources\":[\"value::tenant\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"resourceGroup\",\"formatter\":1},{\"columnMatch\":\"보존기간(일)\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"nameLA\",\"formatter\":5}]}},\"name\":\"쿼리 - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":null,\\\"headers\\\":[],\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"{ARG_LA}/providers/Microsoft.SecurityInsights/alertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-10-01-preview\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$..properties\\\",\\\"columns\\\":[{\\\"path\\\":\\\"$.enabled\\\",\\\"columnid\\\":\\\"flag\\\",\\\"columnType\\\":\\\"long\\\",\\\"substringRegexMatch\\\":\\\".*\\\",\\\"substringReplace\\\":\\\"1\\\"},{\\\"path\\\":\\\"$.enabled\\\",\\\"columnid\\\":\\\"isEnabled\\\",\\\"columnType\\\":\\\"string\\\"}]}}]}\",\"size\":1,\"title\":\"{ARG_LANAME} 분석규칙 현황\",\"queryType\":12,\"visualization\":\"categoricalbar\",\"sortBy\":[],\"tileSettings\":{\"showBorder\":false},\"chartSettings\":{\"xAxis\":\"isEnabled\",\"seriesLabelSettings\":[{\"seriesName\":\"true\",\"label\":\"활성화\",\"color\":\"green\"},{\"seriesName\":\"false\",\"label\":\"비활성화\",\"color\":\"redDark\"}],\"xSettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"name\":\"쿼리 - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{ARG_LA}').Usage\\r\\n| where TimeGenerated {REQ_TIME:value}\\r\\n| summarize sum(Quantity) by bin(TimeGenerated, {REQ_TIME:grain})\\r\\n| project TimeGenerated, ['수집량(MByte)']=sum_Quantity\",\"size\":1,\"title\":\"{ARG_LANAME} 작업영역 수집현황(기준:조회기간)\",\"timeContextFromParameter\":\"REQ_TIME\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"sortBy\":[]},\"customWidth\":\"50\",\"name\":\"쿼리 - 8\"}]},\"customWidth\":\"33\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SEC_OVERVIEW\"},\"name\":\"SEC_OVERVIEW_GROUP_02\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## 인시던트 상세\\r\\n---\"},\"name\":\"텍스트 - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"33c96400-fbac-4de8-bb26-c1635d3fe7bd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_SUB\",\"label\":\"구독\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type == \\\"microsoft.resources/subscriptions\\\"\\r\\n| project id, name\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607\"},{\"id\":\"1772f4ed-f70b-44fb-accc-d230e4f3058e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_RG\",\"label\":\"리소스그룹\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type =~ \\\"microsoft.resources/subscriptions/resourcegroups\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\"\\r\\n| project id, name\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourceGroups/Eland_Sentinal\"},{\"id\":\"08744f4c-cf09-4aeb-a82b-105635680b7c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_LA\",\"label\":\"LogAnalytics 작업영역\",\"type\":2,\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\" and (resourceGroup =~ \\\"{SEC_MON_RG:label}\\\")\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"d041e0b9-0f07-45b2-9ccd-412c1070b89f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_TIME_G\",\"label\":\"조회기간\",\"type\":4,\"isRequired\":true,\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"value\":{\"durationMs\":172800000}},{\"id\":\"598e18b2-11fd-42c4-b5b2-0cc23fea4420\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_ARG_SEV\",\"label\":\"심각도\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"let SortOrder = datatable(Value:string, SortOrder:int)\\r\\n[\\\"High\\\", 1, \\\"Medium\\\", 2, \\\"Low\\\", 3, \\\"Informational\\\", 4];\\r\\nworkspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| summarize Count=count() by Severity\\r\\n| extend Label = strcat(Severity,\\\" [\\\",Count,\\\"]\\\")\\r\\n| project Label, Value=Severity\\r\\n| distinct  Value, Label\\r\\n| join kind=leftouter SortOrder on Value\\r\\n| project Value, Label\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"637b3c04-43fd-4281-881f-e044df8f945a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_ARG_STATUS\",\"label\":\"처리상태\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| summarize count() by Status\\r\\n| extend Label = strcat(Status,\\\" [\\\",count_,\\\"]\\\")\\r\\n| project Value=Status, Label\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"3a9e180a-0b16-4662-9edc-c3731cd874d4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_ARG_OWNER\",\"label\":\"소유자\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| summarize count() by Owner\\r\\n| extend Label = strcat(Owner,\\\" [\\\",count_,\\\"]\\\")\\r\\n| project Value=Owner, Label\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"94e38919-0297-4596-adc0-63ebd365bed5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_ARG_TYPE\",\"label\":\"위협분류\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| where \\\"{SEC_MON_ARG_OWNER}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_OWNER})\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\].*\\\"\\r\\n| summarize count() by alertType\\r\\n| extend Label = strcat(alertType,\\\" [\\\",count_,\\\"]\\\")\\r\\n| project Value=alertType, Label\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"90af3082-e26c-4354-98af-e67df3ef86e1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SELECT_TREND_VIEW\",\"label\":\"인시던트 트랜드\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Enable\\\", \\\"label\\\": \\\"활성화\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Disable\\\", \\\"label\\\": \\\"비활성화\\\" }\\r\\n ]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"51\",\"name\":\"매개 변수 - 4\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a3ab0381-9a13-4048-8561-a52b6945cf09\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SET_DUETYPE\",\"label\":\"비교기간\",\"type\":10,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"day\\\", \\\"label\\\": \\\"1일전\\\" },\\r\\n { \\\"value\\\": \\\"week\\\", \\\"label\\\": \\\"1주일 전\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"month\\\", \\\"label\\\": \\\"1달 전\\\" }\\r\\n\\r\\n ]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"day\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TREND_VIEW\",\"comparison\":\"isEqualTo\",\"value\":\"임시\"},\"name\":\"매개 변수 - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where CreatedTime >= datetime_add('{SET_DUETYPE}', -1, todatetime('{SEC_MON_TIME_G:startISO}')) and \\r\\n        CreatedTime <= datetime_add('{SET_DUETYPE}', -1, todatetime('{SEC_MON_TIME_G:endISO}'))\\r\\n| extend CreatedTime = datetime_add('{SET_DUETYPE}', 1, todatetime(CreatedTime))\\r\\n| make-series count() on CreatedTime step({SEC_MON_TIME_G:grain})\\r\\n| mv-expand CreatedTime, count_ | sort by todatetime(CreatedTime) asc | extend type = \\\"COMP\\\", joinKey = row_number()\\r\\n| union ( SecurityIncident\\r\\n    | where CreatedTime {SEC_MON_TIME_G:value}\\r\\n    | make-series count() on CreatedTime step({SEC_MON_TIME_G:grain})\\r\\n    | mv-expand CreatedTime, count_ | sort by todatetime(CreatedTime) asc | extend type = \\\"ORG\\\", joinKey = row_number() )\\r\\n| summarize sum(todecimal(count_)) by todatetime(CreatedTime), type\\r\\n\\r\\n\\r\\n\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":9244800000,\"endTime\":\"2023-01-16T05:47:00.000Z\"},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"sortBy\":[],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"COMP\",\"label\":\"비교기간\"},{\"seriesName\":\"ORG\",\"label\":\"조회기간\"}]}},\"conditionalVisibility\":{\"parameterName\":\"BLANK\",\"comparison\":\"isEqualTo\",\"value\":\"임시저장\"},\"name\":\"쿼리 - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| where \\\"{SEC_MON_ARG_OWNER}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_OWNER})\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where \\\"{SEC_MON_ARG_TYPE}\\\" == \\\"'*'\\\" or alertType in ({SEC_MON_ARG_TYPE})\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by bin(CreatedTime, {SEC_MON_TIME_G:grain}), Severity\",\"size\":1,\"title\":\"시간별 심각도[{SEC_MON_ARG_SEV}] 발생현황\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"timeBrushParameterName\":\"SEC_MON_TIME_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"CreatedTime\",\"label\":\"발생시간\"},{\"columnId\":\"IncidentNumber\",\"label\":\"인시던트 번호\"},{\"columnId\":\"Severity\",\"label\":\"심각도\"},{\"columnId\":\"Status\",\"label\":\"인시던트 처리현황\"},{\"columnId\":\"Owner\",\"label\":\"소유자\"},{\"columnId\":\"alertType\",\"label\":\"분류\"},{\"columnId\":\"alertDesc\",\"label\":\"발생 경보명\"},{\"columnId\":\"Description\",\"label\":\"상세내용\"},{\"columnId\":\"IncidentUrl\",\"label\":\"인시던트 조사\"}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TREND_VIEW\",\"comparison\":\"isEqualTo\",\"value\":\"Enable\"},\"name\":\"쿼리 - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| where \\\"{SEC_MON_ARG_OWNER}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_OWNER})\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where \\\"{SEC_MON_ARG_TYPE}\\\" == \\\"'*'\\\" or alertType in ({SEC_MON_ARG_TYPE})\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by Status\\r\\n\",\"size\":1,\"title\":\"인시던트[{SEC_MON_ARG_STATUS}] 처리현황\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"timeBrushParameterName\":\"SEC_MON_TIME_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"CreatedTime\",\"label\":\"발생시간\"},{\"columnId\":\"IncidentNumber\",\"label\":\"인시던트 번호\"},{\"columnId\":\"Severity\",\"label\":\"심각도\"},{\"columnId\":\"Status\",\"label\":\"인시던트 처리현황\"},{\"columnId\":\"Owner\",\"label\":\"소유자\"},{\"columnId\":\"alertType\",\"label\":\"분류\"},{\"columnId\":\"alertDesc\",\"label\":\"발생 경보명\"},{\"columnId\":\"Description\",\"label\":\"상세내용\"},{\"columnId\":\"IncidentUrl\",\"label\":\"인시던트 조사\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TREND_VIEW\",\"comparison\":\"isEqualTo\",\"value\":\"Enable\"},\"name\":\"쿼리 - 5 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| where \\\"{SEC_MON_ARG_OWNER}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_OWNER})\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where \\\"{SEC_MON_ARG_TYPE}\\\" == \\\"'*'\\\" or alertType in ({SEC_MON_ARG_TYPE})\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| summarize count() by alertType\\r\\n\",\"size\":1,\"title\":\"위협별[{SEC_MON_ARG_TYPE}] 발생현황\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"timeBrushParameterName\":\"SEC_MON_TIME_G\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"CreatedTime\",\"label\":\"발생시간\"},{\"columnId\":\"IncidentNumber\",\"label\":\"인시던트 번호\"},{\"columnId\":\"Severity\",\"label\":\"심각도\"},{\"columnId\":\"Status\",\"label\":\"인시던트 처리현황\"},{\"columnId\":\"Owner\",\"label\":\"소유자\"},{\"columnId\":\"alertType\",\"label\":\"분류\"},{\"columnId\":\"alertDesc\",\"label\":\"발생 경보명\"},{\"columnId\":\"Description\",\"label\":\"상세내용\"},{\"columnId\":\"IncidentUrl\",\"label\":\"인시던트 조사\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"25\",\"conditionalVisibility\":{\"parameterName\":\"SELECT_TREND_VIEW\",\"comparison\":\"isEqualTo\",\"value\":\"Enable\"},\"name\":\"쿼리 - 5 - 복사 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where CreatedTime {SEC_MON_TIME_G:value}\\r\\n| extend Owner=iff(isempty(tostring(Owner.assignedTo)), \\\"Unassigned\\\", (tostring(Owner.assignedTo)))\\r\\n| where \\\"{SEC_MON_ARG_SEV}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_SEV})\\r\\n| where \\\"{SEC_MON_ARG_STATUS}\\\" == \\\"'*'\\\" or Status in ({SEC_MON_ARG_STATUS})\\r\\n| where \\\"{SEC_MON_ARG_OWNER}\\\" == \\\"'*'\\\" or Severity in ({SEC_MON_ARG_OWNER})\\r\\n| parse kind=regex Title with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where \\\"{SEC_MON_ARG_TYPE}\\\" == \\\"'*'\\\" or alertType in ({SEC_MON_ARG_TYPE})\\r\\n| extend IncidentUrl = replace_string(IncidentUrl, \\\"/\\\", \\\"%2F\\\")\\r\\n| extend IncidentUrl = replace_string(IncidentUrl, \\\"https:%2F%2Fportal.azure.com%2F#asset%2FMicrosoft_Azure_Security_Insights%2FIncident\\\", \\r\\n                                                    \\\"https://portal.azure.com/#view/Microsoft_Azure_Security_Insights/IncidentPage.ReactView/incidentArmId/\\\")\\r\\n| extend alertCnt = tostring(AdditionalData.alertsCount)\\r\\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\\r\\n| project CreatedTime, IncidentNumber, Severity, Status, Owner, alertType, alertDesc, Description, alertCnt, IncidentUrl, AlertIds, alertNum\\r\\n| sort by CreatedTime desc\",\"size\":0,\"title\":\"결과 [{$rowCount} 건] / 조건 [심각도:{SEC_MON_ARG_SEV} / 처리상태:{SEC_MON_ARG_STATUS} / 소유자:{SEC_MON_ARG_OWNER} / 분류:{SEC_MON_ARG_TYPE}]\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"exportedParameters\":[{\"fieldName\":\"IncidentNumber\",\"parameterName\":\"INC_NUM\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"Description\",\"parameterName\":\"INC_DESC\",\"parameterType\":1,\"defaultValue\":\"경보의 상세내용이 표시됩니다.\"},{\"fieldName\":\"AlertIds\",\"parameterName\":\"INC_ALERTIDS\",\"parameterType\":1,\"defaultValue\":\"null\"}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CreatedTime\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.8567ch\"}},{\"columnMatch\":\"IncidentNumber\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16.8567ch\"}},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"11.2841ch\"}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"New\",\"representation\":\"Important\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Active\",\"representation\":\"Start\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Closed\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Deleted\",\"representation\":\"Delete\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"12.7127ch\"}},{\"columnMatch\":\"Owner\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16.2841ch\"}},{\"columnMatch\":\"alertType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"18ch\"}},{\"columnMatch\":\"alertDesc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"55.5714ch\"}},{\"columnMatch\":\"Description\",\"formatter\":5},{\"columnMatch\":\"alertCnt\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"13.4286ch\"}},{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"바로가기(새창)\",\"customColumnWidthSetting\":\"17.1429ch\"}},{\"columnMatch\":\"AlertIds\",\"formatter\":5},{\"columnMatch\":\"alertNum\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"CreatedTime\",\"label\":\"발생시간\"},{\"columnId\":\"IncidentNumber\",\"label\":\"인시던트 번호\"},{\"columnId\":\"Severity\",\"label\":\"심각도\"},{\"columnId\":\"Status\",\"label\":\"처리현황\"},{\"columnId\":\"Owner\",\"label\":\"소유자\"},{\"columnId\":\"alertType\",\"label\":\"분류\"},{\"columnId\":\"alertDesc\",\"label\":\"제목\"},{\"columnId\":\"Description\",\"label\":\"상세내용\"},{\"columnId\":\"alertCnt\",\"label\":\"관련경고\"},{\"columnId\":\"IncidentUrl\",\"label\":\"인시던트 조사\"}]}},\"customWidth\":\"60\",\"name\":\"쿼리 - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityIncident\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| where ProviderIncidentId == '{INC_NUM}'\\r\\n| sort by TimeGenerated desc\\r\\n| extend Classification = strcat(Classification, \\\"-\\\", ClassificationReason, \\\": \\\", ClassificationComment)\\r\\n| extend alertCnt = tostring(AdditionalData.alertsCount)\\r\\n| extend cntComments = array_length(Comments)\\r\\n| extend cntLabels = array_length(Labels)\\r\\n| extend assignedTo = tostring(Owner.assignedTo)\\r\\n| extend nextSeverity = next(Severity, 1)\\r\\n| extend nextStatus = next(Status, 1)\\r\\n| extend nextClass = next(Classification, 1)\\r\\n| extend nextAssigned = next(assignedTo, 1)\\r\\n| extend nextComments = next(Comments, 1)\\r\\n| extend nextCntComm = next(cntComments, 1)\\r\\n| extend nextLabels = next(Labels, 1)\\r\\n| extend nextCntLabels = next(cntLabels, 1)\\r\\n| extend nextAlertCnt = next(alertCnt, 1)\\r\\n//| extend modType = case( isempty(FirstModifiedTime), \\\"인시던트 생성\\\", \\r\\n| extend modType = case( CreatedTime == LastModifiedTime, \\\"인시던트 생성\\\", \\r\\n                            alertCnt != nextAlertCnt, \\\"인시던트 그룹 경고추가\\\", \\r\\n                            Severity != nextSeverity, \\\"심각도 변경\\\", \\r\\n                            Status != nextStatus, \\\"상태 변경\\\", \\r\\n                            assignedTo != nextAssigned, case(isempty(nextAssigned), \\\"인시던트 신규할당\\\", isempty(assignedTo), \\\"인시던트 할당해제\\\", \\\"인시던트 할당변경\\\" ), \\r\\n                            Classification != nextClass, \\\"닫힘 결과 수정\\\", \\r\\n                            tostring(Comments) != tostring(nextComments), case(cntComments > nextCntComm, \\\"주석 추가\\\", \\r\\n                                                                                    cntComments == nextCntComm, \\\"주석 수정\\\", \\\"주석 삭제\\\" ), \\r\\n                            tostring(Labels) != tostring(nextLabels), case(cntLabels > nextCntLabels, \\\"태그 추가\\\", \\\"태그 삭제\\\"), \\r\\n                            \\\"신규\\\" )\\r\\n| extend sumDesc = case( modType == \\\"인시던트 생성\\\", strcat(ModifiedBy, \\\" 에 의해 인시던트 생성\\\"), \\r\\n                            modType == \\\"인시던트 그룹 경고추가\\\", strcat(\\\"[변경전] \\\", nextAlertCnt, \\\"개 [변경후] \\\", alertCnt, \\\"개\\\"), \\r\\n                            modType == \\\"심각도 변경\\\", strcat(\\\"[변경전] \\\", nextSeverity, \\\" [변경후] \\\", Severity), \\r\\n                            modType == \\\"상태 변경\\\", strcat(\\\"[변경전] \\\", nextStatus, \\\" [변경후] \\\", iff(Status =~ \\\"closed\\\", strcat(Status, \\\" (결과) \\\", Classification), Status)), \\r\\n                            modType == \\\"인시던트 신규할당\\\", strcat(\\\"[할당사용자] \\\", assignedTo), \\r\\n                            modType == \\\"인시던트 할당변경\\\", strcat(\\\"[변경전] \\\", nextAssigned, \\\" [변경후] \\\", assignedTo), \\r\\n                            modType == \\\"주석 추가\\\" or modType == \\\"주석 수정\\\", tostring(Comments[-1].message), \\r\\n                            modType == \\\"태그 추가\\\", tostring(Labels[0].labelName), \\r\\n                            \\\"해당사항 없음\\\" )\\r\\n| extend Comments = iff(Comments == \\\"[]\\\", todynamic(\\\"[{}]\\\"), Comments)\\r\\n| mv-expand Comments\\r\\n| extend modMsg = Comments.message\\r\\n| extend modTime = totime(Comments.lastModifiedTimeUtc)\\r\\n| sort by TimeGenerated desc, modTime desc\\r\\n| summarize arg_max(modTime, modType, sumDesc, modMsg, ModifiedBy) by TimeGenerated\\r\\n| extend sumDesc = iff(modType == \\\"주석 수정\\\", modMsg, sumDesc)\\r\\n| project TimeGenerated, modType, sumDesc, ModifiedBy\",\"size\":0,\"title\":\"인시던트 {INC_NUM} 활동 로그 (최근 1주일)\",\"noDataMessage\":\"최근 30일간 인시던트 활동이력이 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.1424ch\"}},{\"columnMatch\":\"modType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.4286ch\"}},{\"columnMatch\":\"sumDesc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"53.1429ch\"}},{\"columnMatch\":\"ModifiedBy\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"22.1416ch\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"modType\",\"label\":\"작업구분\"},{\"columnId\":\"sumDesc\",\"label\":\"수행 및 변경내용\"},{\"columnId\":\"ModifiedBy\",\"label\":\"작업사용자\"}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":1},\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\"}},\"customWidth\":\"40\",\"name\":\"쿼리 - 8\"},{\"type\":1,\"content\":{\"json\":\"## 상세내용 : {INC_DESC}\",\"style\":\"info\"},\"customWidth\":\"100\",\"name\":\"텍스트 - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| where SystemAlertId in~ (todynamic('{INC_ALERTIDS}'))\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId)\\r\\n| project joinKey\\r\\n| join ( workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId) ) on joinKey\\r\\n| project TimeGenerated, AlertSeverity, AlertName, Description\",\"size\":1,\"title\":\"연관경고 전체 [{$rowCount} 건]\",\"noDataMessage\":\"해당 엔터티에 대한 관련 경고가 없습니다.\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"exportFieldName\":\"Description\",\"exportParameterName\":\"ALERT_DESC\",\"exportDefaultValue\":\"경고를 선택하면 상세내용이 표시됩니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.4281ch\"}},{\"columnMatch\":\"AlertSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"13.4281ch\"}},{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"76.4281ch\"}},{\"columnMatch\":\"Description\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"AlertSeverity\",\"label\":\"심각도\"},{\"columnId\":\"AlertName\",\"label\":\"경고명\"}]}},\"customWidth\":\"40\",\"conditionalVisibility\":{\"parameterName\":\"INC_ALERTIDS\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},\"name\":\"쿼리 - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| where SystemAlertId in~ (todynamic('{INC_ALERTIDS}'))\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId)\\r\\n| project joinKey\\r\\n| join ( workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId) ) on joinKey\\r\\n| parse AlertName with * \\\"[\\\" alertType \\\"]\\\" *\\r\\n| summarize count() by bin(TimeGenerated, {SEC_MON_TIME_G:grain}), alertType\",\"size\":1,\"title\":\"시간별 경고발생 현황\",\"noDataMessage\":\"해당 엔터티에 대한 관련 경고가 없습니다.\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"exportFieldName\":\"Description\",\"exportParameterName\":\"ALERT_DESC\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34ch\"}},{\"columnMatch\":\"AlertSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"85.5714ch\"}},{\"columnMatch\":\"Description\",\"formatter\":5}],\"filter\":true},\"chartSettings\":{\"showDataPoints\":true}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"INC_ALERTIDS\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},\"name\":\"쿼리 - 11 - 복사 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| where SystemAlertId in~ (todynamic('{INC_ALERTIDS}'))\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId)\\r\\n| project joinKey\\r\\n| join ( workspace('{SEC_MON_LA}').SecurityAlert\\r\\n| where TimeGenerated {SEC_MON_TIME_G:value}\\r\\n| mv-expand todynamic(Entities)\\r\\n| where Entities.Type == \\\"account\\\"\\r\\n| extend joinKey = tostring(Entities.AadUserId) ) on joinKey\\r\\n| parse AlertName with * \\\"[\\\" alertType \\\"]\\\" *\\r\\n| summarize count() by alertType\\r\\n\\r\\n\\r\\n\",\"size\":1,\"title\":\"경고 유형별 발생 현황\",\"noDataMessage\":\"해당 엔터티에 대한 관련 경고가 없습니다.\",\"timeContextFromParameter\":\"SEC_MON_TIME_G\",\"exportFieldName\":\"Description\",\"exportParameterName\":\"ALERT_DESC\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34ch\"}},{\"columnMatch\":\"AlertSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"AlertName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"85.5714ch\"}},{\"columnMatch\":\"Description\",\"formatter\":5}],\"filter\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"alertType\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"INC_ALERTIDS\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},\"name\":\"쿼리 - 11 - 복사\"},{\"type\":1,\"content\":{\"json\":\"## 상세내용 : {ALERT_DESC}\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"INC_ALERTIDS\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},\"showPin\":false,\"name\":\"텍스트 - 5 - 복사\"}]},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SEC_MON\"},\"name\":\"SEC_MON_GROUP_01\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## 계정 위협 및 활동\\r\\n---\"},\"name\":\"텍스트 - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"value::tenant\"],\"parameters\":[{\"id\":\"245c82f8-83db-41c1-b300-970f53dfd11c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_SUB\",\"label\":\"구독\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type == \\\"microsoft.resources/subscriptions\\\"\\r\\n| project id, name\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607\"},{\"id\":\"c21c5e99-d849-4b42-9044-9804ee1ec7d6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_RG\",\"label\":\"리소스그룹\",\"type\":2,\"isRequired\":true,\"query\":\"resourcecontainers\\r\\n| where type =~ \\\"microsoft.resources/subscriptions/resourcegroups\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\"\\r\\n| project id, name\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourceGroups/Eland_Sentinal\"},{\"id\":\"72207cb9-be5c-4165-83d2-0204be43d229\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEC_MON_LA\",\"label\":\"LogAnalytics 작업영역\",\"type\":2,\"isRequired\":true,\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" and\\r\\n        id hasprefix \\\"{SEC_MON_SUB}\\\" and (resourceGroup =~ \\\"{SEC_MON_RG:label}\\\")\",\"crossComponentResources\":[\"value::tenant\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resources/tenants\"},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"ID_MON\"},\"name\":\"매개 변수 - 1 - 복사 - 복사\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"c4b2220c-b432-44f6-896e-9e3e244195d9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"VISIBLE_DELACC\",\"label\":\"삭제(예정) 계정보기\",\"type\":10,\"description\":\"완전삭제, 삭제대기 계정을 표시합니다.\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\r\\n        \\\"label\\\": \\\"표시안함(기본)\\\",\\r\\n        \\\"value\\\": \\\"삭제\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"삭제예정\\\",\\r\\n        \\\"value\\\": \\\"완전삭제\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"전체표시\\\",\\r\\n        \\\"value\\\": \\\"*\\\"\\r\\n    }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"삭제\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').IdentityInfo\\r\\n| where TimeGenerated >= ago(15d)\\r\\n| summarize arg_max(TimeGenerated, *) by AccountObjectId\\r\\n| join kind=fullouter ( workspace('{SEC_MON_LA}').AuditLogs \\r\\n| where TimeGenerated >= ago(30d)\\r\\n| where Result =~ \\\"success\\\" and (OperationName =~ \\\"add user\\\" or OperationName =~ \\\"delete user\\\")\\r\\n| extend AccountObjectId = tostring(TargetResources[0].id)\\r\\n| summarize arg_max(TimeGenerated, OperationName) by AccountObjectId ) on AccountObjectId\\r\\n| where isnotempty(AccountUPN)\\r\\n| extend DeletedDateTime = iff(OperationName =~ \\\"delete user\\\", TimeGenerated1, DeletedDateTime)\\r\\n| extend delDays = todecimal(datetime_diff('day', now(), DeletedDateTime))\\r\\n| extend adminFlag = iff( AssignedRoles contains \\\"admin\\\", \\\"관리자\\\", \\\"사용자\\\")\\r\\n| extend accStatus = case((isnotempty(DeletedDateTime) and delDays<30), strcat(\\\"삭제대기(D-\\\", 30-(datetime_diff('day', now(), DeletedDateTime)), \\\")\\\"), \\r\\n                            (isnotempty(DeletedDateTime) and delDays>=30), \\\"완전삭제\\\", IsAccountEnabled == \\\"false\\\", \\\"잠김\\\", \\\"정상\\\" )\\r\\n| extend fullName = iff((isempty(GivenName) and isempty(Surname)), \\\"\\\", strcat(GivenName, \\\" \\\", Surname))\\r\\n| where \\\"{VISIBLE_DELACC}\\\" == \\\"*\\\" or accStatus !contains \\\"{VISIBLE_DELACC}\\\"\\r\\n| project accStatus, AccountDisplayName, AccountUPN, UserType, adminFlag, AssignedRoles, GroupMembership, AccountCreationTime, DeletedDateTime, AccountObjectId, \\r\\n            Department = coalesce(Department, \\\"정보없음\\\"), \\r\\n            fullName = coalesce(fullName, \\\"정보없음\\\"), \\r\\n            EmployeeId = coalesce(EmployeeId, \\\"정보없음\\\"), \\r\\n            MailAddress = coalesce(MailAddress, \\\"정보없음\\\"), \\r\\n            Phone = coalesce(Phone, \\\"정보없음\\\")\\r\\n\\r\\n\",\"size\":0,\"title\":\"결과 [{$rowCount} 건]\",\"exportedParameters\":[{\"fieldName\":\"AccountObjectId\",\"parameterName\":\"AAD_ID\",\"parameterType\":1,\"defaultValue\":\"*\"},{\"fieldName\":\"AccountUPN\",\"parameterName\":\"ACC_UPN\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"AccountDisplayName\",\"parameterName\":\"ACC_NAME\",\"parameterType\":1,\"defaultValue\":\"전체\"},{\"fieldName\":\"Department\",\"parameterName\":\"DEPT_NAME\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"fullName\",\"parameterName\":\"FULL_NAME\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"EmployeeId\",\"parameterName\":\"EMP_ID\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"MailAddress\",\"parameterName\":\"MAIL_ADDR\",\"parameterType\":1,\"defaultValue\":\"null\"},{\"fieldName\":\"Phone\",\"parameterName\":\"PHONE_NUM\",\"parameterType\":1,\"defaultValue\":\"null\"}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"accStatus\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"contains\",\"thresholdValue\":\"삭제대기\",\"representation\":\"1\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"잠김\",\"representation\":\"Lock\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"완전삭제\",\"representation\":\"Delete\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"Available\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":null,\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"12.5ch\"},\"tooltipFormat\":{\"tooltip\":\"삭제대기 계정은 복원이 가능하며 완전삭제까지 기간을 표시합니다.\"}},{\"columnMatch\":\"AccountDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"AccountUPN\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"UserType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"12ch\"}},{\"columnMatch\":\"adminFlag\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"관리자\",\"representation\":\"Important\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AssignedRoles\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"}},{\"columnMatch\":\"GroupMembership\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"31ch\"}},{\"columnMatch\":\"AccountCreationTime\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"26ch\"}},{\"columnMatch\":\"DeletedDateTime\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"13.1429ch\"}},{\"columnMatch\":\"AccountObjectId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"Department\",\"formatter\":5},{\"columnMatch\":\"fullName\",\"formatter\":5},{\"columnMatch\":\"EmployeeId\",\"formatter\":5},{\"columnMatch\":\"MailAddress\",\"formatter\":5},{\"columnMatch\":\"Phone\",\"formatter\":5}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"accStatus\",\"label\":\"계정상태\",\"comment\":\"\"},{\"columnId\":\"AccountDisplayName\",\"label\":\"사용자명\"},{\"columnId\":\"AccountUPN\",\"label\":\"사용자 계정\"},{\"columnId\":\"UserType\",\"label\":\"사용자 유형\"},{\"columnId\":\"adminFlag\",\"label\":\"권한구분\"},{\"columnId\":\"AssignedRoles\",\"label\":\"할당권한\"},{\"columnId\":\"GroupMembership\",\"label\":\"소속그룹\"},{\"columnId\":\"AccountCreationTime\",\"label\":\"생성날짜\"},{\"columnId\":\"DeletedDateTime\",\"label\":\"삭제날짜\"}]}},\"customWidth\":\"60\",\"name\":\"쿼리 - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').IdentityInfo\\r\\n| where TimeGenerated >= ago(15d)\\r\\n| summarize arg_max(TimeGenerated, *) by AccountObjectId\\r\\n| join kind=fullouter ( workspace('{SEC_MON_LA}').AuditLogs \\r\\n| where TimeGenerated >= ago(15d)\\r\\n| where Result =~ \\\"success\\\" and (OperationName =~ \\\"add user\\\" or OperationName =~ \\\"delete user\\\")\\r\\n| extend AccountObjectId = tostring(TargetResources[0].id)\\r\\n| summarize arg_max(TimeGenerated, OperationName) by AccountObjectId ) on AccountObjectId\\r\\n| where isnotempty(AccountUPN)\\r\\n| extend DeletedDateTime = iff(OperationName =~ \\\"delete user\\\", TimeGenerated1, DeletedDateTime)\\r\\n| extend delDays = todecimal(datetime_diff('day', now(), DeletedDateTime))\\r\\n| extend adminFlag = iff( AssignedRoles contains \\\"admin\\\", \\\"관리자\\\", \\\"사용자\\\")\\r\\n| extend accStatus = case((isnotempty(DeletedDateTime) and delDays<30), strcat(\\\"삭제대기(D-\\\", 30-(datetime_diff('day', now(), DeletedDateTime)), \\\")\\\"), \\r\\n                            (isnotempty(DeletedDateTime) and delDays>=30), \\\"완전삭제\\\", IsAccountEnabled == \\\"false\\\", \\\"잠김\\\", \\\"정상\\\" )\\r\\n| extend fullName = iff((isempty(GivenName) and isempty(Surname)), \\\"\\\", strcat(GivenName, \\\" \\\", Surname))\\r\\n| where accStatus != \\\"완전삭제\\\"\\r\\n| summarize lockAcc = countif(accStatus == \\\"잠김\\\"), delAcc = countif(accStatus contains \\\"삭제대기\\\"), userType = countif(UserType =~ \\\"guest\\\"), \\r\\n                adminAcc = countif(accStatus == \\\"정상\\\" and adminFlag == \\\"관리자\\\")//, userAcc = countif(accStatus == \\\"정상\\\" and adminFlag == \\\"사용자\\\")\\r\\n| evaluate narrow()\\r\\n| sort by Value desc\",\"size\":0,\"title\":\"유형별 계정현황 (일반사용자 제외)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Value\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Value\",\"sortOrder\":2}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Column\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Value\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":false,\"sortCriteriaField\":\"Value\",\"sortOrderField\":2},\"chartSettings\":{\"xAxis\":\"Column\",\"yAxis\":[\"Value\"],\"seriesLabelSettings\":[{\"seriesName\":\"lockAcc\",\"label\":\"비활성화(잠금)계정\"},{\"seriesName\":\"delAcc\",\"label\":\"삭제예정계정\"},{\"seriesName\":\"userType\",\"label\":\"외부(Guest)계정\"},{\"seriesName\":\"adminAcc\",\"label\":\"관리자계정\"},{\"seriesName\":\"userAcc\",\"label\":\"사용자계정\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"40\",\"name\":\"쿼리 - 6\"},{\"type\":1,\"content\":{\"json\":\"#### 추가정보: [사번] {EMP_ID}   /   [이름] {FULL_NAME}   /   [부서] {DEPT_NAME}   /   [메일주소] {MAIL_ADDR}\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"FULL_NAME\",\"comparison\":\"isNotEqualTo\",\"value\":\"null\"},\"name\":\"텍스트 - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### 사용자 {ACC_NAME}({AAD_ID}) 활동이력\\r\\n---\"},\"name\":\"텍스트 - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"81dae46b-ea3e-4356-845b-3bd4e8699966\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ACC_SEARCH_TIME\",\"label\":\"검색기간\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":7776000000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let TABLE_LIST = datatable(TABLE_NAME:string) [\\\"경고\\\", \\\"감사\\\", \\\"로그인\\\", \\\"활동\\\"];\\r\\nlet ALERT_LOGS = workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or Entities has '{AAD_ID}'\\r\\n| make-series kind = nonempty Trend = count() default = 0 on TimeGenerated from {ACC_SEARCH_TIME:start} to {ACC_SEARCH_TIME:end} step {ACC_SEARCH_TIME:grain}\\r\\n| extend TABLE_NAME = \\\"경고\\\";\\r\\nlet AUDIT_LOGS = workspace('{SEC_MON_LA}').AuditLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or InitiatedBy has '{AAD_ID}' or TargetResources has '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, OperationName, Result) by CorrelationId\\r\\n| project-away CorrelationId\\r\\n| make-series kind = nonempty Trend = count() default = 0 on TimeGenerated from {ACC_SEARCH_TIME:start} to {ACC_SEARCH_TIME:end} step {ACC_SEARCH_TIME:grain}\\r\\n| extend TABLE_NAME = \\\"감사\\\";\\r\\nlet SIGNIN_LOGS = workspace('{SEC_MON_LA}').SigninLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, OperationName, ResultType ) by CorrelationId\\r\\n| extend Result = ResultType\\r\\n| project-away CorrelationId, ResultType\\r\\n| make-series kind = nonempty Trend = count() default = 0 on TimeGenerated from {ACC_SEARCH_TIME:start} to {ACC_SEARCH_TIME:end} step {ACC_SEARCH_TIME:grain}\\r\\n| extend TABLE_NAME = \\\"로그인\\\";\\r\\nlet ACTIVITY_LOGS = workspace('{SEC_MON_LA}').AzureActivity | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| extend UserId = tostring(Claims_d.[\\\"http://schemas.microsoft.com/identity/claims/objectidentifier\\\"])\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| where ActivityStatusValue =~ \\\"success\\\" or ActivityStatusValue =~ \\\"failure\\\"\\r\\n| summarize arg_max(TimeGenerated, CategoryValue, ActivityStatusValue) by CorrelationId\\r\\n| extend OperationName = CategoryValue\\r\\n| extend Result = ActivityStatusValue\\r\\n| project-away CorrelationId, CategoryValue, ActivityStatusValue\\r\\n| make-series kind = nonempty Trend = count() default = 0 on TimeGenerated from {ACC_SEARCH_TIME:start} to {ACC_SEARCH_TIME:end} step {ACC_SEARCH_TIME:grain}\\r\\n| extend TABLE_NAME = \\\"활동\\\";\\r\\nTABLE_LIST\\r\\n| join kind=leftouter ( union ALERT_LOGS, AUDIT_LOGS, SIGNIN_LOGS, ACTIVITY_LOGS ) on TABLE_NAME\\r\\n| mv-expand TimeGenerated, Trend\\r\\n| project todatetime(TimeGenerated), Trend, TABLE_NAME\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"Trend\"],\"xSettings\":{\"numberFormatSettings\":{\"unit\":27,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"name\":\"쿼리 - 2\"},{\"type\":1,\"content\":{\"json\":\"### 경고\"},\"customWidth\":\"25\",\"name\":\"텍스트 - 3\"},{\"type\":1,\"content\":{\"json\":\"### 감사\"},\"customWidth\":\"25\",\"name\":\"텍스트 - 4\"},{\"type\":1,\"content\":{\"json\":\"### 활동\"},\"customWidth\":\"25\",\"name\":\"텍스트 - 5\"},{\"type\":1,\"content\":{\"json\":\"### 로그인\"},\"customWidth\":\"25\",\"name\":\"텍스트 - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or Entities has '{AAD_ID}'\\r\\n| parse kind=regex DisplayName with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| summarize count() by alertType\",\"size\":1,\"noDataMessage\":\"검색된 경고로그가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"alertType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2},\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true}},\"customWidth\":\"25\",\"name\":\"쿼리 - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').AuditLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or InitiatedBy has '{AAD_ID}' or TargetResources has '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, *) by CorrelationId\\r\\n| summarize count() by OperationName\\r\\n| sort by count_\",\"size\":1,\"noDataMessage\":\"검색된 감사로그가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"alertType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2},\"chartSettings\":{\"xAxis\":\"OperationName\"}},\"customWidth\":\"25\",\"name\":\"쿼리 - 1 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').AzureActivity | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| extend UserId = tostring(Claims_d.[\\\"http://schemas.microsoft.com/identity/claims/objectidentifier\\\"])\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| where ActivityStatusValue =~ \\\"success\\\" or ActivityStatusValue =~ \\\"failure\\\"\\r\\n| summarize arg_max(TimeGenerated, ResourceProviderValue, OperationNameValue) by CorrelationId\\r\\n| parse kind = regex OperationNameValue with resType \\\"/\\\" actionType\\r\\n//| extend resultAct = strcat(CategoryValue, \\\"-\\\", actionType)\\r\\n| summarize count() by resType, actionType\\r\\n| sort by count_\",\"size\":1,\"noDataMessage\":\"검색된 활동로그가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"resType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"62.2843ch\"}},{\"columnMatch\":\"actionType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15.8561ch\"}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10.7123ch\"}},{\"columnMatch\":\"그룹\",\"formatter\":1},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}}],\"labelSettings\":[{\"columnId\":\"resType\",\"label\":\"리소스종류\"},{\"columnId\":\"actionType\",\"label\":\"활동구분\"},{\"columnId\":\"count_\",\"label\":\"건수\"}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"alertType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"customWidth\":\"25\",\"name\":\"쿼리 - 1 - 복사 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SigninLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, *) by CorrelationId\\r\\n| extend ResultDescription = iff(isempty(ResultDescription), \\\"로그인성공\\\", strcat(\\\"로그인실패(\\\", ResultDescription,\\\")\\\"))\\r\\n| summarize count() by ResultDescription\\r\\n| sort by count_\\r\\n//| summarize \\r\\n\",\"size\":1,\"noDataMessage\":\"검색된 로그인로그가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blue\"}}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"alertType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":false,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"customWidth\":\"25\",\"name\":\"쿼리 - 1 - 복사 - 복사 - 복사\"},{\"type\":1,\"content\":{\"json\":\"## 상세로그 조회\\r\\n---\"},\"name\":\"텍스트 - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"120e9db6-82e1-4f0d-b26c-34cf46a4f9aa\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEARCH_TYPE\",\"label\":\"로그구분\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\r\\n        \\\"label\\\": \\\"경고(기본)\\\",\\r\\n        \\\"value\\\": \\\"0\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"감사\\\",\\r\\n        \\\"value\\\": \\\"1\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"활동\\\",\\r\\n        \\\"value\\\": \\\"2\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"로그인\\\",\\r\\n        \\\"value\\\": \\\"3\\\"\\r\\n    }\\r\\n\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"3\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or Entities has '{AAD_ID}'\\r\\n| parse kind=regex DisplayName with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| project TimeGenerated, alertType, alertDesc, AlertSeverity, Description, ProductName\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"title\":\"{SEARCH_TYPE:label} 로그 전체 {$rowCount}개\",\"noDataMessage\":\"검색 결과가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"26.5694ch\"}},{\"columnMatch\":\"alertType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"22.2843ch\"}},{\"columnMatch\":\"alertDesc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"63.2857ch\"}},{\"columnMatch\":\"AlertSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"Description\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"218.2857ch\"}},{\"columnMatch\":\"ProductName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"alertType\",\"label\":\"경고구분\"},{\"columnId\":\"alertDesc\",\"label\":\"경고명\"},{\"columnId\":\"AlertSeverity\",\"label\":\"심각도\"},{\"columnId\":\"Description\",\"label\":\"경고 상세정보\"},{\"columnId\":\"ProductName\",\"label\":\"솔루션구분\"}]}},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"0\"},\"name\":\"쿼리 - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').AuditLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or InitiatedBy has '{AAD_ID}' or TargetResources has '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, *) by CorrelationId\\r\\n| extend initByObj = iff(isempty(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName), tostring(InitiatedBy.user.id))\\r\\n| extend targetObj = iff(isempty(TargetResources[0].userPrincipalName), tostring(TargetResources[0].type), tostring(TargetResources[0].id))\\r\\n| join kind = leftouter ( workspace('{SEC_MON_LA}').IdentityInfo | where TimeGenerated >= ago(15d) | summarize arg_max(TimeGenerated, *) by AccountObjectId | extend initByObj = AccountObjectId ) on initByObj\\r\\n| join kind = leftouter ( workspace('{SEC_MON_LA}').IdentityInfo | where TimeGenerated >= ago(15d) | summarize arg_max(TimeGenerated, *) by AccountObjectId | extend targetObj = AccountObjectId ) on targetObj\\r\\n| project TimeGenerated, Category, OperationName, Result, \\r\\n            AccountName = coalesce(AccountName, initByObj), \\r\\n            AccountUPN = coalesce(AccountUPN, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            GroupMembership = coalesce(GroupMembership, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            AssignedRoles = coalesce(AssignedRoles, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            UserType = coalesce(UserType, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            AccountName1 = coalesce(AccountName1, targetObj),\\r\\n            AccountUPN1 = coalesce(AccountUPN1, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            GroupMembership1 = coalesce(GroupMembership1, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            AssignedRoles1 = coalesce(AssignedRoles1, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            UserType1 = coalesce(UserType1, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            initByObj, targetObj\\r\\n| sort by TimeGenerated desc\\r\\n\",\"size\":0,\"title\":\"{SEARCH_TYPE:label} 로그 전체 {$rowCount}개\",\"noDataMessage\":\"검색 결과가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"26.998ch\"}},{\"columnMatch\":\"Category\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"23.999ch\"}},{\"columnMatch\":\"OperationName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"27.7129ch\"}},{\"columnMatch\":\"Result\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15.4286ch\"}},{\"columnMatch\":\"AccountName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"36.1414ch\"}},{\"columnMatch\":\"AccountUPN\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"33.1424ch\"}},{\"columnMatch\":\"GroupMembership\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"21ch\"}},{\"columnMatch\":\"AssignedRoles\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"30ch\"}},{\"columnMatch\":\"UserType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"AccountName1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.57ch\"}},{\"columnMatch\":\"AccountUPN1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"29.7139ch\"}},{\"columnMatch\":\"GroupMembership1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"22ch\"}},{\"columnMatch\":\"AssignedRoles1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"43.999ch\"}},{\"columnMatch\":\"UserType1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19.1414ch\"}},{\"columnMatch\":\"initByObj\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"40.1439ch\"}},{\"columnMatch\":\"targetObj\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"39.4296ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"Category\",\"label\":\"명령구분\"},{\"columnId\":\"OperationName\",\"label\":\"수행명령\"},{\"columnId\":\"Result\",\"label\":\"수행결과\"}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":1}]},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"name\":\"쿼리 - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').AzureActivity | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| extend UserId = tostring(Claims_d.[\\\"http://schemas.microsoft.com/identity/claims/objectidentifier\\\"])\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| where ActivityStatusValue =~ \\\"success\\\" or ActivityStatusValue =~ \\\"failure\\\"\\r\\n| summarize arg_max(TimeGenerated, *) by CorrelationId\\r\\n| parse kind = regex OperationNameValue with resType \\\"/\\\" actionType\\r\\n| extend opScope = iff(ResourceGroup == \\\"\\\", \\\"Subscription\\\", \\\"ResourceGroup\\\")\\r\\n| extend opScope = iff(_ResourceId matches regex @\\\"\\\\/subscriptions\\\\/.+\\\\/resourcegroups\\\\/.+\\\\/providers\\\\/.+\\\\/providers\\\\/.+\\\", \\\"Resource\\\" , opScope)\\r\\n| project TimeGenerated, CategoryValue, Caller, UserId, CallerIpAddress, opScope, SubscriptionId, ResourceGroup = coalesce(ResourceGroup, \\\"해당사항없음\\\"), _ResourceId, tostring(Properties_d.message), ActivityStatusValue\\r\\n| sort by TimeGenerated desc\",\"size\":0,\"title\":\"{SEARCH_TYPE:label} 로그 전체 {$rowCount}개\",\"noDataMessage\":\"검색 결과가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34ch\"}},{\"columnMatch\":\"CategoryValue\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Caller\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"35.1414ch\"}},{\"columnMatch\":\"UserId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"CallerIpAddress\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"opScope\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"SubscriptionId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"ResourceGroup\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"36.1429ch\"}},{\"columnMatch\":\"_ResourceId\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true,\"customColumnWidthSetting\":\"44.4266ch\"}},{\"columnMatch\":\"Properties_d_message\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"52.7143ch\"}},{\"columnMatch\":\"ActivityStatusValue\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"25ch\"}},{\"columnMatch\":\"Authorization_d_scope\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"CategoryValue\",\"label\":\"작업구분\"},{\"columnId\":\"Caller\",\"label\":\"작업자\"},{\"columnId\":\"UserId\",\"label\":\"작업자 Azure AD ID\"},{\"columnId\":\"CallerIpAddress\",\"label\":\"작업IP\"},{\"columnId\":\"opScope\",\"label\":\"작업범위(구독/리소스그룹/리소스)\"},{\"columnId\":\"SubscriptionId\",\"label\":\"작업구독\"},{\"columnId\":\"ResourceGroup\",\"label\":\"작업리소스그룹\"},{\"columnId\":\"_ResourceId\",\"label\":\"작업리소스\"},{\"columnId\":\"Properties_d_message\",\"label\":\"작업상세\"},{\"columnId\":\"ActivityStatusValue\",\"label\":\"작업결과\"}]}},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"2\"},\"name\":\"쿼리 - 12 - 복사 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SigninLogs | where TimeGenerated {ACC_SEARCH_TIME:value}\\r\\n| where '{AAD_ID}' == '*' or UserId == '{AAD_ID}'\\r\\n| summarize arg_max(TimeGenerated, *) by CorrelationId\\r\\n| extend ResultType = iff(ResultType == 0, \\\"성공\\\", strcat(\\\"실패(\\\", ResultType, \\\")\\\"))\\r\\n| extend ResultDescription = iff(isempty(ResultDescription), \\\"로그인 성공\\\", ResultDescription)\\r\\n| extend LocationDetail_ = strcat(tostring(LocationDetails.state), \\\" \\\", tostring(LocationDetails.city))\\r\\n| extend IsLogonHomeTen = iff(HomeTenantId == ResourceTenantId, \\\"홈 테넌트 계정\\\", \\\"다른 테넌트 계정\\\")\\r\\n| join kind = leftouter ( workspace('{SEC_MON_LA}').IdentityInfo | where TimeGenerated >= ago(15d) | summarize arg_max(TimeGenerated, *) by AccountObjectId | extend UserId = AccountObjectId ) on UserId\\r\\n| project TimeGenerated, UserDisplayName, UserPrincipalName, ResultType, ResultDescription, AppDisplayName, \\r\\n            ClientAppUsed = coalesce(ClientAppUsed, \\\"정보없음\\\"), \\r\\n            IPAddress, Location, LocationDetail_,  \\r\\n            GroupMembership = coalesce(GroupMembership, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            AssignedRoles = coalesce(AssignedRoles, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            UserType1 = coalesce(UserType1, \\\"해당사항없음(서비스계정)\\\"), \\r\\n            IsLogonHomeTen, UserId, HomeTenantId, ResourceTenantId\\r\\n| sort by TimeGenerated desc\\r\\n\",\"size\":0,\"title\":\"{SEARCH_TYPE:label} 로그 전체 {$rowCount}개\",\"noDataMessage\":\"검색 결과가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34ch\"}},{\"columnMatch\":\"UserDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"21ch\"}},{\"columnMatch\":\"UserPrincipalName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"ResultType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"16ch\"}},{\"columnMatch\":\"ResultDescription\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20.7133ch\"}},{\"columnMatch\":\"AppDisplayName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.7129ch\"}},{\"columnMatch\":\"ClientAppUsed\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"IPAddress\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Location\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"14ch\"}},{\"columnMatch\":\"LocationDetail_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34.5704ch\"}},{\"columnMatch\":\"GroupMembership\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"21ch\"}},{\"columnMatch\":\"AssignedRoles\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"32ch\"}},{\"columnMatch\":\"UserType1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"}},{\"columnMatch\":\"IsLogonHomeTen\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"UserId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"HomeTenantId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}},{\"columnMatch\":\"ResourceTenantId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42ch\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"UserDisplayName\",\"sortOrder\":1}],\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생일시\"},{\"columnId\":\"UserDisplayName\",\"label\":\"계정명\"},{\"columnId\":\"UserPrincipalName\",\"label\":\"계정명(UPN)\"},{\"columnId\":\"ResultType\",\"label\":\"로그인결과\"},{\"columnId\":\"ResultDescription\",\"label\":\"로그인결과 상세\"},{\"columnId\":\"AppDisplayName\",\"label\":\"로그인 APP\"},{\"columnId\":\"ClientAppUsed\",\"label\":\"로그인 접근방식\"},{\"columnId\":\"IPAddress\",\"label\":\"로그인 IP\"},{\"columnId\":\"Location\",\"label\":\"국가코드\"},{\"columnId\":\"LocationDetail_\",\"label\":\"접근지역상세\"},{\"columnId\":\"GroupMembership\",\"label\":\"소속그룹\"},{\"columnId\":\"AssignedRoles\",\"label\":\"할당권한\"},{\"columnId\":\"UserType1\",\"label\":\"계정종류\"},{\"columnId\":\"IsLogonHomeTen\",\"label\":\"소속테넌트\"},{\"columnId\":\"UserId\",\"label\":\"계정 AzureAD ID\"},{\"columnId\":\"HomeTenantId\",\"label\":\"홈테넌트 ID\"},{\"columnId\":\"ResourceTenantId\",\"label\":\"접근테넌트 ID\"}]},\"sortBy\":[{\"itemKey\":\"UserDisplayName\",\"sortOrder\":1}]},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"3\"},\"name\":\"쿼리 - 12 - 복사 - 복사 - 복사\"}]},\"conditionalVisibility\":{\"parameterName\":\"AAD_ID\",\"comparison\":\"isNotEqualTo\",\"value\":\"*\"},\"name\":\"그룹 - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"ID_MON\"},\"name\":\"SEC_MON_GROUP_02\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## 서버 모니터링\"},\"name\":\"텍스트 - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').Heartbeat\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| where isnotempty(ResourceId)\\r\\n| summarize arg_max(TimeGenerated, *) by ResourceId\\r\\n| extend dueTime = now() - TimeGenerated\\r\\n| extend AgentStatus = iff(totimespan(dueTime)>=totimespan(5m), \\\"비정상\\\", \\\"정상\\\")\\r\\n| extend _ResourceId = tolower(ResourceId)\\r\\n| join kind=leftouter ( union workspace('{SEC_MON_LA}').SecurityEvent, workspace('{SEC_MON_LA}').Syslog\\r\\n| where TimeGenerated >= ago(1d)\\r\\n| summarize arg_max(TimeGenerated, Computer) by _ResourceId\\r\\n| extend _ResourceId = tolower(_ResourceId) ) on _ResourceId\\r\\n| join kind=leftouter ( workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated >= ago(7d) \\r\\n| mv-expand todynamic(Entities) | where isnotempty(Entities.ResourceId) \\r\\n| extend _ResourceId = tolower(tostring(Entities.ResourceId))\\r\\n| summarize count() by _ResourceId ) on _ResourceId\\r\\n| project ResourceId, Computer, AgentStatus, TimeGenerated1, count_, OSType, OSName, ComputerPrivateIPs\",\"size\":1,\"title\":\"에이전트 설치 현황 [{$rowCount} 대] (지난 30일)\",\"exportedParameters\":[{\"fieldName\":\"ResourceId\",\"parameterName\":\"RES_ID\",\"parameterType\":1,\"defaultValue\":\"*\"},{\"fieldName\":\"Computer\",\"parameterName\":\"COM_NAME\",\"parameterType\":1,\"defaultValue\":\"전체(*)\"}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ResourceId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.1429ch\"}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34.4286ch\"}},{\"columnMatch\":\"AgentStatus\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"TimeGenerated1\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24ch\"}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"20.4286ch\"}},{\"columnMatch\":\"OSType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17.1429ch\"}},{\"columnMatch\":\"OSName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"31.7143ch\"}},{\"columnMatch\":\"ComputerPrivateIPs\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"42.7143ch\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"ResourceId\",\"label\":\"리소스 이름(바로가기)\"},{\"columnId\":\"Computer\",\"label\":\"컴퓨터 이름\"},{\"columnId\":\"AgentStatus\",\"label\":\"에이전트 상태\"},{\"columnId\":\"TimeGenerated1\",\"label\":\"마지막 로그 수집시간\"},{\"columnId\":\"count_\",\"label\":\"발생경고(최근7일)\"},{\"columnId\":\"OSType\",\"label\":\"운영체제 구분\"},{\"columnId\":\"OSName\",\"label\":\"운영체제 종류\"},{\"columnId\":\"ComputerPrivateIPs\",\"label\":\"컴퓨터 IP\"}]}},\"customWidth\":\"50\",\"showPin\":false,\"name\":\"쿼리 - Heartbeat\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated >= ago(7d)\\r\\n| where '{RES_ID}' == '*' or Entities has '{RES_ID}'\\r\\n| parse kind=regex DisplayName with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where alertNum matches regex \\\"^[\\\\\\\\d]2[\\\\\\\\d]{6}\\\"\\r\\n| project TimeGenerated, alertType, alertDesc, AlertSeverity, Description, ProductName\",\"size\":1,\"title\":\"{COM_NAME} 발생 경고 리스트[{$rowCount} 개] (지난 7일)\",\"noDataMessage\":\"검색 결과가 없습니다.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"26.5694ch\"}},{\"columnMatch\":\"alertType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"22.2843ch\"}},{\"columnMatch\":\"alertDesc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"27.5714ch\"}},{\"columnMatch\":\"AlertSeverity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Medium\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Informational\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"blue\",\"text\":\"{0}{1}\"}],\"customColumnWidthSetting\":\"19ch\"}},{\"columnMatch\":\"Description\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"111.2857ch\"}},{\"columnMatch\":\"ProductName\",\"formatter\":5,\"formatOptions\":{\"customColumnWidthSetting\":\"20ch\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"TimeGenerated\",\"label\":\"발생시간\"},{\"columnId\":\"alertType\",\"label\":\"경고구분\"},{\"columnId\":\"alertDesc\",\"label\":\"경고명\"},{\"columnId\":\"AlertSeverity\",\"label\":\"심각도\"},{\"columnId\":\"Description\",\"label\":\"경고 상세정보\"},{\"columnId\":\"ProductName\",\"label\":\"솔루션구분\"}]}},\"customWidth\":\"50\",\"name\":\"쿼리 - 12 - 복사\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated >= ago(7d)\\r\\n| where '{RES_ID}' == '*' or Entities has '{RES_ID}'\\r\\n| parse kind=regex DisplayName with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where alertNum matches regex \\\"^[\\\\\\\\d]2[\\\\\\\\d]{6}\\\"\\r\\n| make-series kind = nonempty Trend = count() default = 0 on TimeGenerated from ago(7d) to now() step 1h\",\"size\":1,\"title\":\"{COM_NAME} 경고 발생 추이 (지난 7일)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"60\",\"name\":\"쿼리 - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityAlert | where TimeGenerated >= ago(7d)\\r\\n| where '{RES_ID}' == '*' or Entities has '{RES_ID}'\\r\\n| parse kind=regex DisplayName with \\\"\\\\\\\\[\\\" alertType \\\"\\\\\\\\] \\\" alertDesc \\\" \\\\\\\\(\\\" alertNum \\\"\\\\\\\\)\\\"\\r\\n| where alertNum matches regex \\\"^[\\\\\\\\d]2[\\\\\\\\d]{6}\\\"\\r\\n| summarize count() by alertType\",\"size\":1,\"title\":\"{COM_NAME} 경고 타입별 발생현황  (지난 7일)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"40\",\"name\":\"쿼리 - 4\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"텍스트 - 10\"},{\"type\":1,\"content\":{\"json\":\"## 서버 원본로그 검색\"},\"name\":\"텍스트 - 9\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"22f0e563-fed8-47fb-a036-d217ad767785\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEARCH_TYPE\",\"label\":\"검색구분\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\r\\n        \\\"label\\\": \\\"Windows 보안 이벤트\\\",\\r\\n        \\\"value\\\": \\\"0\\\"\\r\\n    },\\r\\n    {\\r\\n        \\\"label\\\": \\\"Syslog\\\",\\r\\n        \\\"value\\\": \\\"1\\\"\\r\\n    }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"0\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 6\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b7af045e-5e6e-4ad5-9476-08a38e9fc6b8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEARCH_RANGE\",\"label\":\"검색기간\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000}]},\"value\":{\"durationMs\":43200000}},{\"id\":\"b8d0429f-c5fa-4deb-b391-94fd9836fa71\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SEARCH_SVR\",\"label\":\"검색서버 선택\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\",\"delimiter\":\" , \",\"query\":\"Heartbeat\\r\\n| where TimeGenerated >= ago(7d)\\r\\n| where isnotempty(ResourceId)\\r\\n| extend flag = iff(OSType =~ \\\"windows\\\", 0, 1)\\r\\n| where {SEARCH_TYPE} == flag\\r\\n| summarize count() by ResourceId, Resource\\r\\n| project ResourceId, Resource\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"매개 변수 - 8\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').SecurityEvent\\r\\n| where TimeGenerated {SEARCH_RANGE:value}\\r\\n| where '{SEARCH_SVR}' == \\\"*\\\" or _ResourceId has '{SEARCH_SVR}'\\r\\n| extend subjectAcc = iff(isnotempty(SubjectUserName), strcat(SubjectUserName, \\\"(\\\", SubjectUserSid, \\\")\\\"), \\\"\\\")\\r\\n| extend targetAcc = iff(isnotempty(TargetUserName), strcat(TargetUserName, \\\"(\\\", TargetUserSid, \\\")\\\"), \\\"\\\")\\r\\n| project TimeGenerated, _ResourceId, Computer, AccountType, Account, Activity, Level, subjectAcc, targetAcc, LogonType, LogonTypeName, ProcessName, ProcessId, EventData\",\"size\":0,\"title\":\"{SEARCH_SVR:label} 서버 로그 검색 결과 [{$rowCount} 개] (지난 7일)\",\"timeContextFromParameter\":\"SEARCH_RANGE\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"23.7143ch\"}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"18.7143ch\"}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34.8571ch\"}},{\"columnMatch\":\"AccountType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"Account\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"Activity\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"43.1429ch\"}},{\"columnMatch\":\"Level\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"subjectAcc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"28.7143ch\"}},{\"columnMatch\":\"targetAcc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"27.7143ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"LogonType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"LogonTypeName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"ProcessName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"33.2857ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"ProcessId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"EventData\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"쿼리 - 5\"}]},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"0\"},\"name\":\"그룹 - 8\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"workspace('{SEC_MON_LA}').Syslog\\r\\n| where TimeGenerated {SEARCH_RANGE:value}\\r\\n| where '{SEARCH_SVR}' == \\\"*\\\" or _ResourceId has '{SEARCH_SVR}'\\r\\n| project TimeGenerated, _ResourceId, SourceSystem, Computer, Facility, HostIP, ProcessName, ProcessID, SeverityLevel, SyslogMessage\\r\\n\",\"size\":0,\"title\":\"{SEARCH_SVR:label} 서버 로그 검색 결과 [{$rowCount} 개] (지난 7일)\",\"timeContextFromParameter\":\"SEARCH_RANGE\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"23.7143ch\"}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"18.7143ch\"}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"34.8571ch\"}},{\"columnMatch\":\"AccountType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"Account\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"17ch\"}},{\"columnMatch\":\"Activity\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"43.1429ch\"}},{\"columnMatch\":\"Level\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"11ch\"}},{\"columnMatch\":\"subjectAcc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"28.7143ch\"}},{\"columnMatch\":\"targetAcc\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"27.7143ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"LogonType\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"LogonTypeName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"19ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"ProcessName\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"33.2857ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"ProcessId\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}},{\"columnMatch\":\"EventData\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"50ch\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"},\"emptyValCustomText\":\"정보없음\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"쿼리 - 5\"}]},\"conditionalVisibility\":{\"parameterName\":\"SEARCH_TYPE\",\"comparison\":\"isEqualTo\",\"value\":\"1\"},\"name\":\"그룹 - 8 - 복사\"}],\"exportParameters\":true},\"conditionalVisibility\":{\"parameterName\":\"SELECT_TAB\",\"comparison\":\"isEqualTo\",\"value\":\"SVR_MON\"},\"name\":\"그룹 - 8\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/3ab8b8ac-6f0b-456d-9116-8930d946a607/resourcegroups/eland_sentinal/providers/microsoft.operationalinsights/workspaces/elandsentinal\"],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}